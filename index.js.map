{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\n\nexport async function getPhotos(query, page = 1, perPage = 15) {\n  const ENDPOINT = 'https://pixabay.com/api/';\n  const API_KEY = '51376542-95e34f1d639dab3c27f4a47b0';\n\n  const queryParams = new URLSearchParams({\n    q: query,\n    key: API_KEY,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n    per_page: perPage,\n    page: page,\n  });\n\n  try {\n    const respData = await axios.get(`${ENDPOINT}?${queryParams}`);\n    return respData.data;\n  } catch (err) {\n    throw err;\n  }\n}\n","import SimpleLightbox from 'simplelightbox';\nimport { refs } from '../main';\n\nconst simpleGallery = new SimpleLightbox('.gallery a');\n\nexport function createGallery(images) {\n  const dynamicMarkup = images\n    .map(\n      item =>\n        `<li><a class=\"img-link\" href=\"${item.largeImageURL}\"><img src=\"${\n          item.webformatURL\n        }\" alt=\"${item.tags}\" width=\"360\" height=\"200\"><ul class=\"img-meta\">\n      <li class=\"meta-list-item\"><span class=\"meta-item-title\">Likes</span> ${\n        item.likes === '' ? 'n/d' : item.likes\n      }</li>\n      <li class=\"meta-list-item\"><span class=\"meta-item-title\">Views</span> ${\n        item.views === '' ? 'n/d' : item.views\n      }</li>\n      <li class=\"meta-list-item\"><span class=\"meta-item-title\">Comments</span> ${\n        item.comments === '' ? 'n/d' : item.comments\n      }</li>\n      <li class=\"meta-list-item\"><span class=\"meta-item-title\">Downloads</span> ${\n        item.downloads === '' ? 'n/d' : item.downloads\n      }</li>\n      </ul>\n      </a>\n      </li>`\n    )\n    .join('');\n  refs.galleryEl.insertAdjacentHTML('beforeend', dynamicMarkup);\n  simpleGallery.refresh();\n}\n\n// Utilities\nexport function clearGallery() {\n  refs.galleryEl.innerHTML = '';\n}\n\nexport function showLoader() {\n  refs.loaderEl.classList.remove('is-hidden');\n}\n\nexport function hideLoader() {\n  refs.loaderEl.classList.add('is-hidden');\n}\n\nexport function showLoadMoreButton() {\n  refs.loadMoreBtn.classList.remove('is-hidden');\n}\n\nexport function hideLoadMoreButton() {\n  refs.loadMoreBtn.classList.add('is-hidden');\n}\n","import iziToast from 'izitoast';\nimport { getPhotos } from './js/pixabay-api';\nimport * as renders from './js/render-functions';\n\n//=== References ===\nexport const refs = {\n  formEl: document.querySelector('.form'),\n  galleryEl: document.querySelector('.gallery'),\n  loadMoreBtn: document.querySelector('.load-more-btn'),\n  loaderEl: document.querySelector('.loader'),\n};\n\n//=== Global Variables ===\nconst perPage = 15;\nlet currentSearchQuery = '';\nlet currentPage = 1;\nlet maxPageCount = 1;\n\n//=== Event Listeners ===\nrefs.formEl.addEventListener('submit', onSubmit);\nrefs.loadMoreBtn.addEventListener('click', onClickLoadMoreBtn);\nrefs.galleryEl.addEventListener('click', onGalleryClick);\n\n//=== Handlers ===\n// Prevent opening large image URL\nfunction onGalleryClick(e) {\n  const clickedEl = e.target;\n\n  if (clickedEl.nodeName === 'IMG') {\n    e.preventDefault();\n  }\n}\n\n// Search query validaton\nasync function onSubmit(event) {\n  event.preventDefault();\n  renders.clearGallery();\n  let respData = null; // onSubmit scope availability for respData\n\n  const searchQuery = event.target.elements['search-text'].value.trim();\n  if (!searchQuery) {\n    return iziToast.error({\n      message: 'Empty request. Try again!',\n      position: 'topRight',\n    });\n  }\n  currentSearchQuery = searchQuery; // Assign validated search query value to the global var to reuse it\n\n  renders.hideLoadMoreButton();\n  renders.showLoader();\n\n  // Server response processing & gallery markup insertion\n  currentPage = 1; // reset page counter for a new submit\n  try {\n    respData = await getPhotos(searchQuery, currentPage, perPage);\n    const hits = respData.hits;\n\n    if (hits.length === 0) {\n      return iziToast.error({\n        message:\n          'Sorry there are no images matching your search query. Please try again!',\n        position: 'topRight',\n      });\n    }\n\n    renders.createGallery(hits);\n  } catch (err) {\n    iziToast.error({\n      message: err.message,\n      position: 'topRight',\n    });\n  } finally {\n    renders.hideLoader();\n\n    // Check if there is more images to show on the next page\n    maxPageCount = Math.ceil(respData.totalHits / perPage);\n\n    if (currentPage !== maxPageCount) {\n      renders.showLoadMoreButton();\n    }\n  }\n\n  event.target.reset();\n}\n\n// Load more button logic\nasync function onClickLoadMoreBtn() {\n  renders.hideLoadMoreButton();\n  renders.showLoader();\n\n  currentPage += 1;\n\n  try {\n    const respNextData = await getPhotos(currentSearchQuery, currentPage);\n    const nextHits = respNextData.hits;\n\n    renders.createGallery(nextHits);\n    // Scroll behaviour //\n    const galleryItemEl = document.querySelector('.gallery li');\n    const galleryItemHeight = galleryItemEl.getBoundingClientRect().height;\n    window.scrollBy({\n      top: galleryItemHeight * 2,\n      left: 0,\n      behavior: 'smooth',\n    });\n    // End of scroll behaviour\n  } catch (err) {\n    iziToast.error({ message: err.message, position: 'topRight' });\n  } finally {\n    renders.hideLoader();\n\n    if (currentPage === maxPageCount) {\n      renders.hideLoadMoreButton();\n      iziToast.info({\n        message: \"We're sorry, but you've reached the end of search results.\",\n        position: 'topRight',\n      });\n    } else {\n      renders.showLoadMoreButton();\n    }\n  }\n}\n"],"names":["getPhotos","query","page","perPage","ENDPOINT","API_KEY","queryParams","axios","err","simpleGallery","SimpleLightbox","createGallery","images","dynamicMarkup","item","refs","clearGallery","showLoader","hideLoader","showLoadMoreButton","hideLoadMoreButton","currentSearchQuery","currentPage","maxPageCount","onSubmit","onClickLoadMoreBtn","onGalleryClick","e","event","renders.clearGallery","respData","searchQuery","iziToast","renders.hideLoadMoreButton","renders.showLoader","hits","renders.createGallery","renders.hideLoader","renders.showLoadMoreButton","nextHits","galleryItemHeight"],"mappings":"owBAEO,eAAeA,EAAUC,EAAOC,EAAO,EAAGC,EAAU,GAAI,CAC7D,MAAMC,EAAW,2BACXC,EAAU,qCAEVC,EAAc,IAAI,gBAAgB,CACtC,EAAGL,EACH,IAAKI,EACL,WAAY,QACZ,YAAa,aACb,WAAY,GACZ,SAAUF,EACV,KAAMD,CACV,CAAG,EAED,GAAI,CAEF,OADiB,MAAMK,EAAM,IAAI,GAAGH,CAAQ,IAAIE,CAAW,EAAE,GAC7C,IACjB,OAAQE,EAAK,CACZ,MAAMA,CACP,CACH,CCnBA,MAAMC,EAAgB,IAAIC,EAAe,YAAY,EAE9C,SAASC,EAAcC,EAAQ,CACpC,MAAMC,EAAgBD,EACnB,IACCE,GACE,iCAAiCA,EAAK,aAAa,eACjDA,EAAK,YACf,UAAkBA,EAAK,IAAI;AAAA,8EAEnBA,EAAK,QAAU,GAAK,MAAQA,EAAK,KAClC;AAAA,8EAECA,EAAK,QAAU,GAAK,MAAQA,EAAK,KAClC;AAAA,iFAECA,EAAK,WAAa,GAAK,MAAQA,EAAK,QACrC;AAAA,kFAECA,EAAK,YAAc,GAAK,MAAQA,EAAK,SACtC;AAAA;AAAA;AAAA,YAIF,EACA,KAAK,EAAE,EACVC,EAAK,UAAU,mBAAmB,YAAaF,CAAa,EAC5DJ,EAAc,QAAO,CACvB,CAGO,SAASO,GAAe,CAC7BD,EAAK,UAAU,UAAY,EAC7B,CAEO,SAASE,GAAa,CAC3BF,EAAK,SAAS,UAAU,OAAO,WAAW,CAC5C,CAEO,SAASG,GAAa,CAC3BH,EAAK,SAAS,UAAU,IAAI,WAAW,CACzC,CAEO,SAASI,GAAqB,CACnCJ,EAAK,YAAY,UAAU,OAAO,WAAW,CAC/C,CAEO,SAASK,GAAqB,CACnCL,EAAK,YAAY,UAAU,IAAI,WAAW,CAC5C,CC/CO,MAAMA,EAAO,CAClB,OAAQ,SAAS,cAAc,OAAO,EACtC,UAAW,SAAS,cAAc,UAAU,EAC5C,YAAa,SAAS,cAAc,gBAAgB,EACpD,SAAU,SAAS,cAAc,SAAS,CAC5C,EAGMZ,EAAU,GAChB,IAAIkB,EAAqB,GACrBC,EAAc,EACdC,EAAe,EAGnBR,EAAK,OAAO,iBAAiB,SAAUS,CAAQ,EAC/CT,EAAK,YAAY,iBAAiB,QAASU,CAAkB,EAC7DV,EAAK,UAAU,iBAAiB,QAASW,CAAc,EAIvD,SAASA,EAAeC,EAAG,CACPA,EAAE,OAEN,WAAa,OACzBA,EAAE,eAAc,CAEpB,CAGA,eAAeH,EAASI,EAAO,CAC7BA,EAAM,eAAc,EACpBC,IACA,IAAIC,EAAW,KAEf,MAAMC,EAAcH,EAAM,OAAO,SAAS,aAAa,EAAE,MAAM,OAC/D,GAAI,CAACG,EACH,OAAOC,EAAS,MAAM,CACpB,QAAS,4BACT,SAAU,UAChB,CAAK,EAEHX,EAAqBU,EAErBE,IACAC,IAGAZ,EAAc,EACd,GAAI,CACFQ,EAAW,MAAM9B,EAAU+B,EAAaT,EAAanB,CAAO,EAC5D,MAAMgC,EAAOL,EAAS,KAEtB,GAAIK,EAAK,SAAW,EAClB,OAAOH,EAAS,MAAM,CACpB,QACE,0EACF,SAAU,UAClB,CAAO,EAGHI,EAAsBD,CAAI,CAC3B,OAAQ3B,EAAK,CACZwB,EAAS,MAAM,CACb,QAASxB,EAAI,QACb,SAAU,UAChB,CAAK,CACL,QAAY,CACR6B,IAGAd,EAAe,KAAK,KAAKO,EAAS,UAAY3B,CAAO,EAEjDmB,IAAgBC,GAClBe,GAEH,CAEDV,EAAM,OAAO,OACf,CAGA,eAAeH,GAAqB,CAClCQ,IACAC,IAEAZ,GAAe,EAEf,GAAI,CAEF,MAAMiB,GADe,MAAMvC,EAAUqB,EAAoBC,CAAW,GACtC,KAE9Bc,EAAsBG,CAAQ,EAG9B,MAAMC,EADgB,SAAS,cAAc,aAAa,EAClB,sBAAqB,EAAG,OAChE,OAAO,SAAS,CACd,IAAKA,EAAoB,EACzB,KAAM,EACN,SAAU,QAChB,CAAK,CAEF,OAAQhC,EAAK,CACZwB,EAAS,MAAM,CAAE,QAASxB,EAAI,QAAS,SAAU,UAAU,CAAE,CACjE,QAAY,CACR6B,IAEIf,IAAgBC,GAClBU,IACAD,EAAS,KAAK,CACZ,QAAS,6DACT,SAAU,UAClB,CAAO,GAEDM,GAEH,CACH"}